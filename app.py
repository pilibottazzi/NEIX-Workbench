import streamlit as st

# =========================
# IMPORTS (SOLO Mesa + Comerciales)
# =========================
from tools.mesa import cartera, ons, vencimientos, bonos
from tools.comerciales import cauciones_mae, cauciones_byma, alquileres

# =========================
# LINK A WEB BACKOFFICE
# =========================
BACKOFFICE_URL = "https://neix-workbench-bo.streamlit.app/"


# =========================================================
# CONFIG
# =========================================================
st.set_page_config(
    page_title="NEIX Workbench",
    page_icon="О",
    layout="wide"
)

# =========================================================
# ESTTICA PREMIUM (ESTABLE)
# =========================================================
st.markdown(
    """
    <style>
    /* ===== Contenedor general ===== */
    .block-container{
        padding-top: 2.4rem;
        max-width: 1240px;
    }

    /* Oculta header nativo SIN romper layout */
    header[data-testid="stHeader"]{
        visibility: hidden;
        height: 3.25rem;
    }

    /* ===== Header ===== */
    .neix-title{
        text-align: center;
        font-weight: 900;
        letter-spacing: .12em;
        font-size: 1.55rem;
        margin-top: .2rem;
        margin-bottom: 4px;
    }
    .neix-caption{
        text-align: center;
        color:#6b7280;
        font-size:.95rem;
        margin-bottom: 18px;
    }

    /* ===== Tabs arriba (alineadas a la izquierda) ===== */
    .stTabs [data-baseweb="tab-list"]{
        justify-content: flex-start;
        gap: 6px;
        border-bottom: 1px solid rgba(0,0,0,0.08);
        padding-left: 2px;
        margin-top: 6px;
    }

    .stTabs [data-baseweb="tab"]{
        background: transparent;
        border: none;
        font-weight: 700;
        color: #6b7280;
        padding: 10px 14px;
        font-size: .95rem;
    }

    .stTabs [data-baseweb="tab"]:hover{
        color:#111827;
        background: transparent;
    }

    .stTabs [aria-selected="true"]{
        color:#111827;
        border-bottom: 3px solid #ef4444; /* rojo NEIX */
    }

    /* ===== Secciones ===== */
    .section-title{
        font-size:1.35rem;
        font-weight:800;
        margin-top: 6px;
        margin-bottom: 2px;
    }
    .section-sub{
        color:#6b7280;
        font-size:.92rem;
        margin-bottom:14px;
    }

    /* ===== Cards ===== */
    .tool-grid{
        display:flex;
        gap:14px;
        flex-wrap:wrap;
        margin-top:6px;
    }

    .tool-btn{
        display:flex;
        align-items:center;
        justify-content:center;
        padding:14px 18px;
        border-radius:14px;
        border:1px solid rgba(0,0,0,0.08);
        background:white;
        text-decoration:none !important;
        font-weight:700;
        color:#0f172a;
        min-width:240px;
        box-shadow:0 2px 10px rgba(0,0,0,0.04);
        transition: all .08s ease;
    }

    .tool-btn:hover{
        transform: translateY(-1px);
        box-shadow:0 8px 22px rgba(0,0,0,0.08);
        border-color: rgba(239,68,68,.35);
    }

    /* Bot贸n destacado rojo (link externo Backoffice) */
    .tool-btn-primary{
        background:#ef4444 !important;
        color:white !important;
        border-color: rgba(0,0,0,0) !important;
    }
    .tool-btn-primary:hover{
        filter: brightness(.96);
        box-shadow:0 10px 26px rgba(239,68,68,.18);
    }
    </style>
    """,
    unsafe_allow_html=True
)

# =========================================================
# ROUTER (?tool=...)
# =========================================================
tool = (st.query_params.get("tool") or "").lower().strip()

if tool:
    st.markdown("<div class='neix-title'>N E I X &nbsp;&nbsp;Workbench</div>", unsafe_allow_html=True)
    st.markdown("<div class='neix-caption'>Navegaci贸n por 谩reas y proyectos</div>", unsafe_allow_html=True)
    st.divider()

    try:
        # Mesa
        if tool == "bonos":
            bonos.render(None)
        elif tool == "ons":
            ons.render(None)
        elif tool == "cartera":
            cartera.render(None)
        elif tool in ("tenencia", "tenencias", "vencimientos"):
            vencimientos.render(None)

        # Comercial
        elif tool == "cauciones_mae":
            cauciones_mae.render(None)
        elif tool == "cauciones_byma":
            cauciones_byma.render(None)
        elif tool == "alquileres":
            alquileres.render(None)

        # Operaciones -> solo link externo
        elif tool in ("operaciones", "backoffice"):
            st.markdown(
                f"""
                <div class="section-title">Operaciones</div>
                <div class="section-sub">Backoffice se abre en web externa (para evitar saturaci贸n del Workbench)</div>
                <div class="tool-grid">
                  <a class="tool-btn tool-btn-primary" href="{BACKOFFICE_URL}" target="_blank" rel="noopener noreferrer">
                    Abrir Backoffice
                  </a>
                </div>
                """,
                unsafe_allow_html=True,
            )

        else:
            st.error("Herramienta no encontrada")

    except Exception as e:
        st.error("Error cargando la herramienta.")
        st.exception(e)

    st.stop()


# =========================================================
# HOME
# =========================================================
st.markdown("<div class='neix-title'>N E I X &nbsp;&nbsp;Workbench</div>", unsafe_allow_html=True)
st.markdown("<div class='neix-caption'>Navegaci贸n por 谩reas y proyectos</div>", unsafe_allow_html=True)

tabs = st.tabs(["Mesa", "Comercial", "Operaciones"])


# =======================
# MESA
# =======================
with tabs[0]:
    st.markdown("<div class='section-title'>Mesa</div>", unsafe_allow_html=True)
    st.markdown("<div class='section-sub'>Bonos, ONs y carteras</div>", unsafe_allow_html=True)

    st.markdown(
        """
        <div class="tool-grid">
          <a class="tool-btn" href="?tool=bonos">Bonos</a>
          <a class="tool-btn" href="?tool=ons">Obligaciones Negociables</a>
          <a class="tool-btn" href="?tool=cartera">Carteras</a>
        </div>
        """,
        unsafe_allow_html=True
    )


# =======================
# COMERCIAL
# =======================
with tabs[1]:
    st.markdown("<div class='section-title'>Comercial</div>", unsafe_allow_html=True)
    st.markdown("<div class='section-sub'>Seguimiento y herramientas comerciales</div>", unsafe_allow_html=True)

    st.markdown(
        """
        <div class="tool-grid">
          <a class="tool-btn" href="?tool=cartera">Carteras</a>
          <a class="tool-btn" href="?tool=cauciones_mae">Cauciones MAE</a>
          <a class="tool-btn" href="?tool=cauciones_byma">Cauciones BYMA</a>
          <a class="tool-btn" href="?tool=alquileres">Alquileres</a>
          <a class="tool-btn" href="?tool=tenencia">Tenencia</a>
        </div>
        """,
        unsafe_allow_html=True
    )


# =======================
# OPERACIONES (solo link externo)
# =======================
with tabs[2]:
    st.markdown("<div class='section-title'>Operaciones</div>", unsafe_allow_html=True)
    st.markdown("<div class='section-sub'>Backoffice se abre en web externa (separada del Workbench)</div>", unsafe_allow_html=True)

    st.markdown(
        f"""
        <div class="tool-grid">
          <a class="tool-btn tool-btn-primary" href="{BACKOFFICE_URL}" target="_blank" rel="noopener noreferrer">
            Abrir Backoffice
          </a>
        </div>
        """,
        unsafe_allow_html=True
    )

